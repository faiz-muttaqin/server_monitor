<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Monitor - Login</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- SweetAlert2 -->
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.0/dist/sweetalert2.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            padding: 20px;
        }
        
        .login-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            width: 100%;
            max-width: 450px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-header h1 {
            color: #2d3748;
            font-weight: 700;
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .login-header p {
            color: #718096;
            font-size: 0.95rem;
        }
        
        .form-floating {
            margin-bottom: 20px;
        }
        
        .form-floating input {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            height: 58px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .form-floating input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-floating label {
            color: #718096;
            font-weight: 500;
        }
        
        .btn-login {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 12px;
            height: 50px;
            font-size: 16px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        .btn-login:active {
            transform: translateY(0);
        }
        
        .btn-login:disabled {
            background: #cbd5e0;
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
        }
        
        .loading-spinner {
            display: none;
        }
        
        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #718096;
            z-index: 10;
            background: transparent;
            border: none;
            padding: 5px;
        }
        
        .password-toggle:hover {
            color: #667eea;
        }
        
        .form-floating.password-field {
            position: relative;
        }
        
        .form-check {
            margin-bottom: 1.5rem;
        }
        
        .form-check-input {
            width: 1.25em;
            height: 1.25em;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .form-check-input:checked {
            background-color: #667eea;
            border-color: #667eea;
        }
        
        .form-check-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-check-label {
            color: #718096;
            font-weight: 500;
            font-size: 0.95rem;
            margin-left: 0.5rem;
        }
        
        .login-footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }
        
        .login-footer p {
            color: #718096;
            font-size: 0.9rem;
            margin: 0;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        
        .server-icon {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 28px;
        }
        
        @media (max-width: 576px) {
            .login-container {
                padding: 30px 25px;
                margin: 10px;
            }
            
            .login-header h1 {
                font-size: 1.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-header">
            <div class="server-icon">
                <i class="fas fa-server"></i>
            </div>
            <h1>Server Monitor</h1>
            <p>Please sign in to your account</p>
        </div>
        
        <form id="loginForm">
            <div class="form-floating">
                <input type="text" class="form-control" id="username" placeholder="Username" required>
                <label for="username"><i class="fas fa-user me-2"></i>Username</label>
            </div>
            
            <div class="form-floating password-field">
                <input type="password" class="form-control" id="password" placeholder="Password" required>
                <label for="password"><i class="fas fa-lock me-2"></i>Password</label>
                <button type="button" class="password-toggle" id="togglePassword">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
            
            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="rememberMe" value="">
                <label class="form-check-label" for="rememberMe">
                    <i class="fas fa-clock me-2"></i>Remember me for 7 days
                </label>
            </div>
            
            <div class="d-grid">
                <button type="submit" class="btn btn-primary btn-login" id="loginButton">
                    <span class="button-text">Sign In</span>
                    <span class="loading-spinner">
                        <i class="fas fa-spinner fa-spin me-2"></i>Signing in...
                    </span>
                </button>
            </div>
        </form>
        
        <div class="login-footer">
            <p><i class="fas fa-shield-alt me-1"></i>Secure login protected</p>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.0/dist/sweetalert2.all.min.js"></script>
    
    <script>
        $(document).ready(function() {
            // Password toggle functionality
            $('#togglePassword').on('click', function() {
                const passwordField = $('#password');
                const toggleIcon = $(this).find('i');
                
                if (passwordField.attr('type') === 'password') {
                    passwordField.attr('type', 'text');
                    toggleIcon.removeClass('fa-eye').addClass('fa-eye-slash');
                } else {
                    passwordField.attr('type', 'password');
                    toggleIcon.removeClass('fa-eye-slash').addClass('fa-eye');
                }
            });
            
            // Form submission
            $('#loginForm').on('submit', function(e) {
                e.preventDefault();
                
                const username = $('#username').val().trim();
                const password = $('#password').val();
                const rememberMe = $('#rememberMe').is(':checked');
                
                // Basic validation
                if (!username || !password) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Incomplete Form',
                        text: 'Please fill in both username and password',
                        showConfirmButton: true,
                        confirmButtonColor: '#667eea',
                        backdrop: true,
                        allowOutsideClick: true
                    });
                    return;
                }
                
                // Show loading state
                const loginButton = $('#loginButton');
                const buttonText = loginButton.find('.button-text');
                const loadingSpinner = loginButton.find('.loading-spinner');
                
                loginButton.prop('disabled', true);
                buttonText.hide();
                loadingSpinner.show();
                
                // Prepare login data
                const loginData = {
                    username: username,
                    password: password,
                    remember_me: rememberMe
                };
                
                // Make AJAX request
                $.ajax({
                    url: '/login',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(loginData),
                    timeout: 10000, // 10 seconds timeout
                    success: function(response, textStatus, xhr) {
                        // Success response (status 200)
                        Swal.fire({
                            icon: 'success',
                            title: 'Login Successful!',
                            text: 'Welcome back! Redirecting to dashboard...',
                            showConfirmButton: false,
                            timer: 1500,
                            timerProgressBar: true,
                            allowOutsideClick: false,
                            allowEscapeKey: false
                        }).then(() => {
                            // Redirect to dashboard
                            window.location.href = '/';
                        });
                    },
                    error: function(xhr, textStatus, errorThrown) {
                        // Error response (non-200 status)
                        let errorMessage = 'Login failed. Please try again.';
                        let errorTitle = 'Login Failed';
                        
                        // Handle different error scenarios
                        if (xhr.status === 401) {
                            errorMessage = 'Invalid username or password. Please check your credentials and try again.';
                            errorTitle = 'Invalid Credentials';
                        } else if (xhr.status === 429) {
                            errorMessage = 'Too many login attempts. Please wait a moment before trying again.';
                            errorTitle = 'Rate Limited';
                        } else if (xhr.status === 500) {
                            errorMessage = 'Server error occurred. Please contact administrator.';
                            errorTitle = 'Server Error';
                        } else if (textStatus === 'timeout') {
                            errorMessage = 'Request timeout. Please check your connection and try again.';
                            errorTitle = 'Connection Timeout';
                        } else if (textStatus === 'error' && xhr.status === 0) {
                            errorMessage = 'Unable to connect to server. Please check your internet connection.';
                            errorTitle = 'Connection Error';
                        }
                        
                        // Try to get error message from response
                        if (xhr.responseJSON && xhr.responseJSON.message) {
                            errorMessage = xhr.responseJSON.message;
                        } else if (xhr.responseJSON && xhr.responseJSON.error) {
                            errorMessage = xhr.responseJSON.error;
                        }
                        
                        // Show error with SweetAlert
                        Swal.fire({
                            icon: 'error',
                            title: errorTitle,
                            text: errorMessage,
                            showConfirmButton: true,
                            confirmButtonColor: '#667eea',
                            backdrop: true,
                            allowOutsideClick: true
                        });
                        
                        // Add shake animation to form
                        $('.login-container').addClass('shake');
                        setTimeout(() => {
                            $('.login-container').removeClass('shake');
                        }, 500);
                        
                        // Clear password field on error
                        $('#password').val('').focus();
                    },
                    complete: function() {
                        // Reset button state
                        const loginButton = $('#loginButton');
                        const buttonText = loginButton.find('.button-text');
                        const loadingSpinner = loginButton.find('.loading-spinner');
                        
                        loginButton.prop('disabled', false);
                        buttonText.show();
                        loadingSpinner.hide();
                    }
                });
            });
            
            // Focus on username field when page loads
            $('#username').focus();
            
            // Enter key handling
            $(document).on('keypress', function(e) {
                if (e.which === 13 && !$('#loginButton').prop('disabled')) {
                    $('#loginForm').submit();
                }
            });
            
            // Clear any previous session data
            if (typeof(Storage) !== "undefined") {
                // You can add session clearing logic here if needed
                localStorage.removeItem('authToken');
                sessionStorage.clear();
            }
            
            console.log('Login page initialized successfully');
        });
    </script>
</body>
</html>